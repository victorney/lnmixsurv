---
title: "Running multiple chains in parallel"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Running multiple chains in parallel}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  message = FALSE,
  warning = FALSE,
  comment = "#>"
)
```

The model is able to run multiple chains in parallel using `OpenMP`. Just specify the number of chains
and the number of cores that should be used.

```{r setup}
library(persistencia)
set.seed(1)
mod1 <- survival_ln_mixture(
  Surv(y, delta) ~ x,
  data = sim_data$data, iter = 2000, chains = 4, cores = 4
)
mod1
```

The number of cores used is limited by the number of chains and the number of available threads (`?parallel::detectCores`).

Currently, there is a label switch problem that makes the use of multiple chains painfull. Also, the model is having numerical
problems and breaks under some seeds. A warning is emited when running multiple chains.

For now, is not possible to control the random seed when using multiple cores.